{"version":3,"file":"accordion.min.js","sources":["../src/accordion.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This file contains an AMD/jQuery module to expand and collapse course rubrics.\n *\n * @package    block_filtered_course_list\n * @copyright  2016 CLAMP\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-env amd */\n/* global define */\n\nvar define = window.define; // Declare the define variable\n\ndefine(['jquery'], ($) => {\n  /**\n   * Simple storage helper using localStorage\n   */\n  var storage = {\n    set: (key, value) => {\n      try {\n        localStorage.setItem('block_fcl_' + key, value);\n      } catch (e) {\n        // Silently fail if localStorage is not available\n      }\n    },\n    get: (key) => {\n      try {\n        return localStorage.getItem('block_fcl_' + key);\n      } catch (e) {\n        return null;\n      }\n    },\n  };\n\n  /**\n   * Expand a rubric.\n   *\n   * @function expandRubric\n   * @param {Element} rubric\n   * @param {Integer} persist\n   */\n  function expandRubric(rubric, persist) {\n    $(rubric).removeClass('block-fcl__rubric--collapsed');\n    $(rubric).addClass('block-fcl__rubric--expanded');\n    $(rubric).attr('aria-expanded', 'true');\n    $(rubric).next().attr('aria-hidden', 'false');\n    if (persist == 1) {\n      storage.set(rubric.dataset.hash, 'expanded');\n    }\n  }\n\n  /**\n   * Collapse a rubric.\n   *\n   * @function collapseRubric\n   * @param {Element} rubric\n   * @param {Integer} persist\n   */\n  function collapseRubric(rubric, persist) {\n    $(rubric).removeClass('block-fcl__rubric--expanded');\n    $(rubric).addClass('block-fcl__rubric--collapsed');\n    $(rubric).attr('aria-expanded', 'false');\n    $(rubric).next().attr('aria-hidden', 'true');\n    if (persist == 1) {\n      storage.set(rubric.dataset.hash, 'collapsed');\n    }\n  }\n\n  return {\n    init: (params) => {\n      var blockid = params.blockid;\n      $('#' + blockid + ' .block-fcl__rubric').each(function() {\n        var state = storage.get(this.dataset.hash);\n        if (!$(this).hasClass('block-fcl__rubric--expanded') && (!state || state == 'collapsed')) {\n          collapseRubric(this, params.persist);\n        }\n        $(this).wrapInner(document.createElement('a'));\n        $(this).find('a').attr('href', '#');\n        $(this).on('click', function(event) {\n          event.preventDefault();\n          $('.block-fcl__rubric').each(function() {\n            $(this).attr('aria-selected', 'false');\n          });\n          $(this).attr('aria-selected', 'true');\n          if ($(this).hasClass('block-fcl__rubric--collapsed')) {\n            expandRubric(this, params.persist);\n          } else if ($(this).hasClass('block-fcl__rubric--expanded')) {\n            collapseRubric(this, params.persist);\n          }\n        });\n      });\n    },\n  };\n});\n"],"names":["define","window","$","storage","set","key","value","localStorage","setItem","e","getItem","collapseRubric","rubric","persist","removeClass","addClass","attr","next","dataset","hash","init","params","blockid","each","state","this","hasClass","wrapInner","document","createElement","find","on","event","preventDefault"],"mappings":";;;;;;;CA4BAA,EAFaC,OAAOD,+CAEb,CAAC,UAAYE,IAIlB,IAAIC,YACGC,CAACC,IAAKC,SACT,IACEC,aAAaC,QAAQ,aAAeH,IAAKC,MAC3C,CAAE,MAAOG,GAET,GANAN,YAQIE,MACJ,IACE,OAAOE,aAAaG,QAAQ,aAAeL,IAC5C,CAAC,MAAOI,GACP,OAAO,IACT,GA4BJ,SAASE,eAAeC,OAAQC,SAC9BX,EAAEU,QAAQE,YAAY,+BACtBZ,EAAEU,QAAQG,SAAS,gCACnBb,EAAEU,QAAQI,KAAK,gBAAiB,SAChCd,EAAEU,QAAQK,OAAOD,KAAK,cAAe,QACtB,GAAXH,SACFV,YAAYS,OAAOM,QAAQC,KAAM,YAErC,CAEA,MAAO,CACLC,KAAOC,SACL,IAAIC,QAAUD,OAAOC,QACrBpB,EAAE,IAAMoB,QAAU,uBAAuBC,KAAK,WAC5C,IAAIC,MAAQrB,YAAYsB,KAAKP,QAAQC,MAChCjB,EAAEuB,MAAMC,SAAS,gCAAoCF,OAAkB,aAATA,OACjEb,eAAec,KAAMJ,OAAOR,SAE9BX,EAAEuB,MAAME,UAAUC,SAASC,cAAc,MACzC3B,EAAEuB,MAAMK,KAAK,KAAKd,KAAK,OAAQ,KAC/Bd,EAAEuB,MAAMM,GAAG,QAAS,SAASC,OArCnC,IAAsBpB,OAAQC,QAsCtBmB,MAAMC,iBACN/B,EAAE,sBAAsBqB,KAAK,WAC3BrB,EAAEuB,MAAMT,KAAK,gBAAiB,QAChC,GACAd,EAAEuB,MAAMT,KAAK,gBAAiB,QAC1Bd,EAAEuB,MAAMC,SAAS,iCA3CPd,OA4CCa,KA5COZ,QA4CDQ,OAAOR,QA3ClCX,EAAEU,QAAQE,YAAY,gCACtBZ,EAAEU,QAAQG,SAAS,+BACnBb,EAAEU,QAAQI,KAAK,gBAAiB,QAChCd,EAAEU,QAAQK,OAAOD,KAAK,cAAe,SACtB,GAAXH,SACFV,YAAYS,OAAOM,QAAQC,KAAM,aAuClBjB,EAAEuB,MAAMC,SAAS,gCAC1Bf,eAAec,KAAMJ,OAAOR,QAEhC,EACF"}